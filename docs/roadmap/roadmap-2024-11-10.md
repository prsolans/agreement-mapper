# Agreement Map - Product Roadmap
**Date:** November 10, 2024
**Status:** Post-Supabase Migration & UX Overhaul

---

## Recent Accomplishments (October 31 - November 10, 2024)

### ‚úÖ Completed Initiatives

1. **Supabase Storage Migration** *(from roadmap-2024-10-31.md)*
   - Created `supabase_storage.py` with full CRUD operations
   - Migrated from Google Sheets to PostgreSQL + JSONB
   - UUID-based identification for stable references
   - Complete setup documentation
   - Ready for Streamlit Cloud deployment

2. **Web UI Reorganization** *(New - User-Driven)*
   - Tab-based navigation: "Main Analysis" vs "Background & Details"
   - 5 slide-based sections optimized for copy/paste workflow
   - Collapsible expanders for each content section
   - Reorganized to mirror Word Doc export structure
   - Focused on DocuSign sales team use case

3. **Sales Enablement Content Generation** *(New - User-Driven)*
   - Executive Summary (3-5 key bullets)
   - Discovery Questions (5-7 validation questions)
   - DocuSign Product Recommendations (aggregated from opportunities)
   - All generated via GPT-4 analysis of research findings

4. **Quote Verification & Confidence Scoring** *(from roadmap-2024-10-31.md)*
   - Created `verification.py` module
   - 5-tier source credibility scoring (IR/SEC filings ‚Üí blogs)
   - URL verification against Tavily search results
   - Multi-factor confidence scores (credibility 40%, verification 30%, completeness 20%, recency 10%)
   - Visual indicators in UI (üü¢ High / üü° Medium / üî¥ Low)

5. **Bug Fixes**
   - Fixed 8 duplicate download button IDs
   - Resolved StreamlitDuplicateElementId errors

---

## Current State Analysis

### What's Working Well
- ‚úÖ **Core Research Pipeline**: Parallel execution, multi-phase analysis
- ‚úÖ **Export Formats**: Word, PowerPoint, JSON, PNG all functional
- ‚úÖ **Storage**: Supabase provides reliable cloud persistence
- ‚úÖ **Quote Verification**: Confidence scoring helps users trust insights
- ‚úÖ **Copy/Paste UX**: Tab-based layout makes content easily accessible

### Pain Points & Opportunities
- ‚ö†Ô∏è **Cost**: Every analysis makes fresh API calls (expensive, slow for repeat analyses)
- ‚ö†Ô∏è **Speed**: No caching means 2-5 minute wait times per company
- ‚ö†Ô∏è **Data Sources**: Limited to Tavily web search (no SEC filings, analyst reports)
- ‚ö†Ô∏è **Customization**: Fixed slide format doesn't accommodate different use cases
- ‚ö†Ô∏è **Context Tracking**: No history of changes to strategic priorities over time
- ‚ö†Ô∏è **Template Flexibility**: Users may want custom slide templates

---

## Priority 1: Performance & Cost Optimization

### Motivation
- **Current Cost**: ~$0.50-1.00 per analysis (Tavily + OpenAI)
- **Current Speed**: 2-5 minutes per company
- **Impact**: Running 100 analyses = $50-100 and 3-8 hours
- **Opportunity**: 70% cost reduction, 50% speed improvement via caching

### Proposed Features

#### 1.1 Smart Caching Layer
- Cache Tavily search results by query (TTL: 7 days)
- Store intermediate research phases in Supabase
- Add "Refresh Analysis" vs "Load Cached" toggle in UI
- Cache key based on: company_name + analysis_date
- Invalidation strategy for stale data

#### 1.2 Cost Tracking & Visibility
- Track OpenAI token usage per analysis
- Track Tavily API calls per analysis
- Display estimated cost before running analysis
- Show cumulative costs in sidebar analytics panel
- Budget alerts and spending caps

#### 1.3 Execution Optimization
- Stream results progressively (show profile ‚Üí priorities ‚Üí opportunities)
- Use GPT-4o-mini for simpler extraction tasks
- Implement partial result rendering
- Profile execution to identify bottlenecks

### Implementation Steps
- [ ] Design caching schema in Supabase (`cached_searches` table)
- [ ] Implement cache lookup/store logic in `research_agent.py`
- [ ] Add "Refresh" toggle in UI
- [ ] Create `cost_tracker.py` module
- [ ] Add cost estimation before analysis
- [ ] Create analytics dashboard in sidebar
- [ ] Profile current execution times
- [ ] Implement streaming/progressive rendering
- [ ] Benchmark cost reduction (before/after)

### Success Metrics
- 70% cost reduction for cached analyses
- 50% faster completion time with cache hits
- Users see cost estimate before running analysis
- Analytics dashboard shows spend trends

### Questions for Discussion
1. What's an acceptable cache TTL? (7 days? 14 days? 30 days?)
2. Should users pay to refresh cached analyses, or always use fresh data?
3. Do you want spending caps/budget limits enforced?
4. Priority level: High / Medium / Low?

---

## Priority 2: Enhanced Data Sources & Research Depth

### Motivation
- **Current State**: Tavily web search only
- **Opportunity**: SEC filings, analyst reports, investor relations pages provide richer insights
- **Value**: Better data = more confident recommendations

### Proposed Features

#### 2.1 SEC EDGAR Integration (Public Companies)
- Fetch 10-K, 10-Q, 8-K filings automatically
- Extract risk factors, business segments, revenue breakdowns
- Parse MD&A (Management Discussion & Analysis) sections
- Track strategic priority evolution across quarters

#### 2.2 Investor Relations Scraping
- Identify and scrape IR pages (ir.company.com, investors.company.com)
- Extract earnings call transcripts
- Parse press releases
- Get latest financial metrics

#### 2.3 Cross-Referencing & Validation
- Verify facts across multiple sources
- Flag contradictions between sources
- Weight newer sources higher
- Surface consensus vs. outlier claims

#### 2.4 Historical Tracking
- Store previous analyses for same company
- Show "What's Changed" comparison view
- Track strategic priority evolution over time
- Alert on major pivots or changes

### Implementation Steps
- [ ] Research SEC EDGAR API access (free, rate-limited)
- [ ] Create `sec_edgar.py` module
- [ ] Add IR page detection logic
- [ ] Implement cross-referencing in `research_agent.py`
- [ ] Design historical analysis schema in Supabase
- [ ] Build "What's Changed" comparison UI
- [ ] Test with mix of public/private companies

### Success Metrics
- 90%+ of public companies include SEC filing data
- 3+ distinct data source types per analysis
- Cross-referencing flags contradictions in 10%+ of claims
- Historical comparison shows meaningful changes

### Questions for Discussion
1. Focus on public companies only, or maintain private company support?
2. Should historical tracking be automatic or manual "Compare" feature?
3. Worth the added complexity and API rate limits?
4. Priority level: High / Medium / Low?

---

## Priority 3: UX & Template Customization

### Motivation
- **Current State**: Fixed 5-slide format for all users
- **User Feedback**: "the goal is still the ability to copy/paste content into a slide format"
- **Opportunity**: Different sales scenarios need different content

### Proposed Features

#### 3.1 Custom Slide Templates
- Allow users to define custom slide structures
- Template library (Standard, Executive Brief, Discovery Prep, Renewal)
- Reorder/hide/add sections per template
- Save custom templates per user

#### 3.2 Content Toggles
- Show/hide individual content blocks
- Adjust executive summary bullet count (3-7 bullets)
- Filter opportunities by value threshold
- Customize discovery question focus areas

#### 3.3 Export Template Customization
- Custom PowerPoint templates (branding, colors, fonts)
- Configurable Word Doc styles
- Email-friendly HTML export
- PDF generation with custom styling

#### 3.4 Collaboration Features (Future)
- Share analyses with team members
- Comment on specific insights
- Suggest edits to generated content
- Team template library

### Implementation Steps
- [ ] Design template schema in Supabase
- [ ] Build template editor UI
- [ ] Implement template rendering logic
- [ ] Create 3-4 default templates
- [ ] Add content toggle controls
- [ ] Custom PowerPoint template support
- [ ] User testing with sales team

### Success Metrics
- 3+ templates actively used by users
- 80% of users customize at least one section
- 50% of users create custom templates
- Export formats match user branding

### Questions for Discussion
1. Are custom templates a high-priority need?
2. What specific templates would be most valuable?
3. Should templates be user-specific or team-shared?
4. Priority level: High / Medium / Low?

---

## Priority 4: Deprecation & Cleanup

### Motivation
- **Current State**: Google Sheets code still present but unused
- **Risk**: Confusing for future development
- **Benefit**: Cleaner codebase, reduced dependencies

### Proposed Actions
- Remove `sheets_storage.py` module
- Remove Google Sheets dependencies from `requirements.txt`
- Archive `GOOGLE_SHEETS_SETUP.md` (move to docs/archive/)
- Update README to remove Google Sheets references
- Clean up unused imports

### Implementation Steps
- [ ] Remove `sheets_storage.py`
- [ ] Remove `st-gsheets-connection` from requirements.txt
- [ ] Create `docs/archive/` folder
- [ ] Move `GOOGLE_SHEETS_SETUP.md` to archive
- [ ] Update README.md
- [ ] Search codebase for any lingering Sheets references

### Success Metrics
- Zero Google Sheets references in active code
- No broken imports or dependencies
- README reflects current architecture

---

## Recommended Implementation Order

Based on impact, urgency, and dependencies:

### Phase 1 (Immediate - Week 1-2): Deprecation & Cleanup
**Why First**: Low effort, high value for maintainability
- Remove Google Sheets code
- Update documentation
- Clean up unused dependencies
- **Estimated Effort**: 2-4 hours

### Phase 2 (High Priority - Week 2-4): Performance & Cost Optimization
**Why Next**: High impact on operational costs and user experience
- Implement caching layer
- Add cost tracking
- Progressive rendering
- **Estimated Effort**: 2-3 days
- **Dependency**: None (can start immediately)

### Phase 3 (Medium Priority - Week 4-6): Enhanced Data Sources
**Why Third**: Significant value-add, but more complex
- SEC EDGAR integration
- Cross-referencing logic
- Historical tracking
- **Estimated Effort**: 3-5 days
- **Dependency**: Cost optimization (caching) helps offset added API costs

### Phase 4 (Future - Week 6+): UX & Template Customization
**Why Last**: Nice-to-have, not critical path
- Custom templates
- Content toggles
- Export customization
- **Estimated Effort**: 2-4 days
- **Dependency**: User feedback needed to prioritize features

---

## Questions for Prioritization Discussion

### General Strategy
1. **Primary Goal**: Cost reduction vs. Feature enhancement vs. User experience?
2. **Timeline**: Fast iteration (1-2 weeks per priority) or deeper work (3-4 weeks)?
3. **Resources**: Solo development or team collaboration?

### Specific Features
1. **Caching**: Is 70% cost savings worth the added complexity?
2. **SEC EDGAR**: Public company focus worth the effort, or stay broad?
3. **Templates**: High-value for sales team or premature optimization?
4. **Historical Tracking**: Compelling for renewals/upsells, or edge case?

### Technical Decisions
1. **Caching Strategy**: Supabase tables vs. Redis vs. filesystem?
2. **Streaming**: Real-time updates via WebSockets or simple polling?
3. **User Auth**: Keep anonymous for now or add Supabase auth?

### Success Metrics
1. **How to measure success**: Cost savings, user engagement, analysis quality, speed?
2. **What's the primary metric**: Dollars saved, analyses per user, time saved?

---

## Notes & Considerations

### Strengths of Current Architecture
- Parallel execution is fast and efficient
- Quote verification adds real credibility
- Supabase provides solid foundation for growth
- Export formats cover major use cases

### Technical Debt
- No test coverage (future consideration)
- Hardcoded prompts (could be externalized)
- Limited error handling in some areas
- No rate limiting or API quota management

### Future Vision (Not Current Roadmap)
- Multi-user collaboration
- CRM integrations (Salesforce, HubSpot)
- API access for programmatic usage
- Industry trend analysis across companies
- Competitive landscape comparison mode

---

## Suggested Improvements to This Plan

### Documentation Organization
- ‚úÖ Separate architecture from roadmap
- ‚úÖ Date-stamp roadmaps for historical context
- üîÑ Consider adding: `docs/decisions/` for ADRs (Architecture Decision Records)
- üîÑ Consider adding: `docs/guides/` for user guides and tutorials

### Development Process
- Add testing strategy (unit tests for verification, integration tests for research)
- Create development vs. production environment configs
- Implement feature flags for gradual rollouts
- Add telemetry/logging for production debugging

### User Research
- Conduct user interviews with DocuSign sales team
- Observe copy/paste workflow in real meetings
- A/B test different UX approaches
- Gather feedback on generated content quality

---

## Next Steps

**To finalize this roadmap, please answer:**

1. **What's the #1 priority right now?**
   - [ ] Reduce costs (caching & optimization)
   - [ ] Better data (SEC filings, cross-referencing)
   - [ ] Better UX (templates, customization)
   - [ ] Code cleanup (remove Google Sheets)

2. **What's your timeline preference?**
   - [ ] Fast iteration (1-2 weeks per priority, ship quickly)
   - [ ] Deep work (3-4 weeks, more polish)

3. **Any specific features or pain points not captured here?**

4. **Should we maintain backward compatibility with anything, or clean break from old code?**

Once these questions are answered, we can update this roadmap with concrete timelines and commitments.
